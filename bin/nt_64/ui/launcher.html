<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>PUBG Lite</title>
    <!-- 
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,500,100|Teko:100,400,300,700|Oswald:400,500,700|Noto+Sans+JP:400,700,900&amp;subset=cyrillic,cyrillic-ext,latin-ext">
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WHWTBZX');</script> -->
  <link href="assets/css/launcher.css?hash=c6af275e29fd2c6644cf" rel="stylesheet"></head>
  <body>
  <!--
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHWTBZX"  height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript> -->

    <div id="app"></div>
    


    <script>

        var launcher_object = null;


      var editorWindow = null;

      // query string dont work :(

      function open_profile_editor_window(profile_id) 
      {
        sessionStorage.setItem('profileEditor_profileId', profile_id);

        const url = 'profile_editor.html';


        //const url = 'profile_editor.html?profile_id=' + encodeURIComponent(profile_id);

        const width = 400;
        const height = 600;

        // Calcula centro da tela
        const left = (screen.width / 2) - (width / 2);
        const top = (screen.height / 2) - (height / 2);

        const windowFeatures = `width=${width},height=${height},left=${left},top=${top},resizable=no,scrollbars=yes`;

        if (!editorWindow || editorWindow.closed) {
          editorWindow = window.open(url, 'Profile Editor', windowFeatures);
        } else {
          editorWindow.focus();
          editorWindow.location.href = url;
        }
      }

      window.bindLauncherAsync().then(obj => {
                                    if(!obj) 
                                    {
                                        console.log("No CEF objects detected");
                                        return;
                                    }

                                    launcher_object = obj;
                                    //launcher_object.Alert(" YouRe UGLY !", " HAHAHAHAHA");


                                    });

      


    document.addEventListener("DOMContentLoaded", function () 
    {
        // Wait the React load main button
        const checkExist = setInterval(function() 
        {
            const gameIndicator = document.querySelector(".front-src-launcher-GameIndicator-GameIndicator__GameIndicator--2H-73");
            const mainBtnWrapper = document.querySelector(".front-src-launcher-GameIndicator-GameIndicator__GameIndicator-MainbtnWrapper--1Yd__");

            if(gameIndicator && mainBtnWrapper) 
            {
                clearInterval(checkExist);
                initializeProfileSelector(gameIndicator, mainBtnWrapper);
            }



        }, 300);
    });

    function initializeProfileSelector(gameIndicator, mainBtnWrapper) 
    {
        // Creates profile selector
        const profileWrapper = document.createElement("div");
        profileWrapper.className = "front-src-launcher-GameIndicator-GameIndicator__GameIndicator-ProfileConfigSelector";

        profileWrapper.innerHTML = `
            <select id="profileSelector">
                <option value="">Create a profile...</option>
                <option value="123">Profile 1</option>
                <option value="456">Profile 2</option>
                <option value="A4002_8922">Profile 3</option>
                <option value="789">Profile 4</option>
                <option value="101">Profile 5</option>
                <option value="112">Profile 6</option>
                <option value="131">Profile 7</option>
            </select>

            <div class="profileButtons">
                <button id="btnNewProfile">NEW</button>
                <button id="btnEditProfile">EDIT</button>
            </div>
        `;

        // Insert selector before main button
        gameIndicator.insertBefore(profileWrapper, mainBtnWrapper);
        gameIndicator.style.position = "relative";

        // Config events
        setupProfileSelectorEvents();
    }

    function setupProfileSelectorEvents() 
    {
        // Função auxiliar para obter o ID selecionado
        function getSelectedProfileId() 
        {
            const selector = document.getElementById('profileSelector');
            return selector ? selector.value : null;
        }

        // Função auxiliar para obter o nome do perfil selecionado
        function getSelectedProfileName() 
        {
            const selector = document.getElementById('profileSelector');
            if(!selector || selector.selectedIndex < 0) return null;
            return selector.options[selector.selectedIndex].textContent;
        }

        // Botão NEW
        document.getElementById('btnNewProfile').addEventListener('click', function() 
        {
            // '0' ou 'new' para indicar novo perfil
            open_profile_editor_window('0');
        });

        // Botão EDIT
        document.getElementById('btnEditProfile').addEventListener('click', function() 
        {
            const profileId = getSelectedProfileId();
            
            if(!profileId) 
            {
                //alert('Please select a profile to edit!');

                launcher_object.Alert(" Please select a profile to edit! \n either the currently selected object is not a valid profile or is corrupted", "Profile Editor Error!");
                return;
            }
            
            const profileName = getSelectedProfileName();
            console.log(`Editing profile: ${profileName} (ID: ${profileId})`);
            
            open_profile_editor_window(profileId);
        });

        // Enter no seletor também abre o editor
        document.getElementById('profileSelector').addEventListener('keypress', function(e) 
        {
            if(e.key === 'Enter') 
            {
                const profileId = getSelectedProfileId();
                if(profileId) 
                {
                    open_profile_editor_window(profileId);
                }
            }
        });
    }

    // **FUNÇÃO GLOBAL para ser usada de qualquer lugar**
    window.getCurrentProfileId = function() 
    {
        const selector = document.getElementById('profileSelector');
        return selector ? selector.value : null;
    };

    window.getCurrentProfileData = function() 
    {
        const selector = document.getElementById('profileSelector');
        if (!selector || selector.selectedIndex < 0) return null;
        
        return {
            id: selector.value,
            name: selector.options[selector.selectedIndex].textContent
        };
    };




    </script>
    <!-- 
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125508473-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag()
      {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-125508473-2');
    </script> -->
  <script type="text/javascript" src="assets/js/launcher.js"></script>
  </body>
</html>
